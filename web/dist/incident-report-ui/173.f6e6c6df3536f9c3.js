"use strict";(self.webpackChunkincident_report_ui=self.webpackChunkincident_report_ui||[]).push([[173],{4682:(G,x,m)=>{m.d(x,{A:()=>r});var A=m(2831),e=m(1571),C=m(9098),v=m(388),T=m(426),I=m(8270),h=m(6895),u=m(4006),f=m(7538),_=m(4447);const b=function(i){return{"has-error":i}};let F=(()=>{class i{constructor(t,n,a,c){this.service=t,this.bsModalRef=n,this.alertService=a,this.utilService=c,this.constant=A.s,this.datepickerConfig={dateInputFormat:A.s.DateFormatMoment,showTime:!1},this.onClose=new e.vpe,this.genericId=0,this.parentId=0,this.description="",this.username="",this.assignmentModel={ID:0,AssignedTo:"",AssignmentInfo:"",FullNameAssignedTo:this.getUserName,DueDate:new Date,ParentAssignmentID:this.getParentId,GenericIncidentID:this.getGenericId,IncidentDescription:this.getDescription,AssignedBy:"",FullNameAssignedBy:"",Cancelled:!1,Completed:!1,CompletionDate:null,IsCurrentUser:!1,Notes:"",Active:!0}}get hasUserName(){return!this.utilService.isEmptyString(this.username)}get getParentId(){return this.parentId}get getGenericId(){return this.genericId}get getDescription(){return this.description}get getUserName(){return this.username}ok(){this.assignmentModel.FullNameAssignedTo=this.getUserName,this.assignmentModel.ParentAssignmentID=this.getParentId,this.assignmentModel.GenericIncidentID=this.getGenericId,this.assignmentModel.IncidentDescription=this.getDescription,this.service.createAssignment(this.assignmentModel).subscribe({next:t=>{this.onClose.emit(t),this.alertService.success("Added new task."),this.bsModalRef?.hide()},error:t=>{this.alertService.error("Could not add new task.")}})}cancel(){this.bsModalRef?.hide()}onChildValueChange(t){this.username=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(C.Y),e.Y36(v.UZ),e.Y36(T.c),e.Y36(I.F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["assignment-modal"]],inputs:{genericId:"genericId",parentId:"parentId",description:"description"},outputs:{onClose:"onClose"},decls:35,vars:15,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],["name","assignmentForm",1,"form-horizontal"],[1,"form-group"],[3,"ngClass"],["for","AssignedTo",1,"col-md-3","control-label"],[1,"col-md-9"],[3,"valueChanged"],["for","DueDate",1,"col-md-3","control-label"],[1,"input-group"],["type","text","name","DueDate","placeholder","Due Date","bsDatepicker","","close-text","Close","required","",1,"form-control",3,"bsConfig","ngModel","ngModelChange"],["dpDueDate","bsDatepicker","dueDate","ngModel"],[1,"input-group-btn"],["type","button",1,"btn","btn-default",3,"click"],[1,"glyphicon","glyphicon-calendar"],["for","AssignmentInfo",1,"col-md-3","control-label"],["name","info","rows","4","required","",1,"form-control",3,"ngModel","ngModelChange"],["assignmentInfo","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-cancel",3,"click"]],template:function(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA()(),e.TgZ(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Assign To"),e.qZA(),e.TgZ(9,"div",7)(10,"user-picker",8),e.NdJ("valueChanged",function(g){return n.onChildValueChange(g)}),e.qZA()()()(),e.TgZ(11,"div",4)(12,"div",5)(13,"label",9),e._uU(14,"Due Date"),e.qZA(),e.TgZ(15,"div",7)(16,"p",10)(17,"input",11,12),e.NdJ("ngModelChange",function(g){return n.assignmentModel.DueDate=g}),e.qZA(),e.TgZ(20,"span",13)(21,"button",14),e.NdJ("click",function(){e.CHM(a);const g=e.MAs(18);return e.KtG(g.show())}),e._UZ(22,"i",15),e.qZA()()()()()(),e.TgZ(23,"div",4)(24,"div",5)(25,"label",16),e._uU(26,"Details"),e.qZA(),e.TgZ(27,"div",7)(28,"textarea",17,18),e.NdJ("ngModelChange",function(g){return n.assignmentModel.AssignmentInfo=g}),e.qZA()()()()()(),e.TgZ(30,"div",19)(31,"button",20),e.NdJ("click",function(){return n.ok()}),e._uU(32,"Add Assignment"),e.qZA(),e.TgZ(33,"button",21),e.NdJ("click",function(){return n.cancel()}),e._uU(34,"Cancel"),e.qZA()()}if(2&t){const a=e.MAs(18),c=e.MAs(19),g=e.MAs(29);e.xp6(2),e.hij("Add New Assignment ",n.assignmentModel.ParentAssignmentID,""),e.xp6(4),e.Q6J("ngClass",e.VKq(9,b,!n.hasUserName)),e.xp6(6),e.Q6J("ngClass",e.VKq(11,b,c.invalid&&(c.dirty||c.touched))),e.xp6(5),e.Q6J("bsConfig",n.datepickerConfig)("ngModel",n.assignmentModel.DueDate),e.xp6(4),e.uIk("aria-expanded",a.isOpen),e.xp6(3),e.Q6J("ngClass",e.VKq(13,b,g.invalid&&(g.dirty||g.touched))),e.xp6(4),e.Q6J("ngModel",n.assignmentModel.AssignmentInfo),e.xp6(3),e.Q6J("disabled",g.invalid||c.invalid||!n.hasUserName)}},dependencies:[h.mk,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.On,u.F,f.Np,f.Y5,_.S]}),i})();function k(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.save())}),e._uU(1,"Save Notes"),e.qZA()}}let D=(()=>{class i{constructor(t,n,a){this.service=t,this.bsModalRef=n,this.alertService=a,this.constant=A.s,this.onClose=new e.vpe}save(){this.assignment&&this.service.saveNotes(this.assignment).subscribe({next:t=>{this.onClose.emit(t.Notes),this.alertService.success("Saved notes for task."),this.bsModalRef?.hide()},error:t=>{this.alertService.error("Error saving notes for task.")}})}cancel(){this.bsModalRef?.hide()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(C.Y),e.Y36(v.UZ),e.Y36(T.c))},i.\u0275cmp=e.Xpm({type:i,selectors:[["notes-modal"]],inputs:{assignment:"assignment"},outputs:{onClose:"onClose"},decls:9,vars:3,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],["rows","15",1,"form-control",3,"disabled","ngModel","ngModelChange"],[1,"modal-footer"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button",1,"btn","btn-cancel",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Notes For Task"),e.qZA()(),e.TgZ(3,"div",2)(4,"textarea",3),e.NdJ("ngModelChange",function(c){return n.assignment.Notes=c}),e.qZA()(),e.TgZ(5,"div",4),e.YNc(6,k,2,0,"button",5),e.TgZ(7,"button",6),e.NdJ("click",function(){return n.cancel()}),e._uU(8,"Cancel"),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("disabled",!(null!=n.assignment&&n.assignment.IsCurrentUser))("ngModel",n.assignment.Notes),e.xp6(2),e.Q6J("ngIf",n.assignment.IsCurrentUser))},dependencies:[h.O5,u.Fj,u.JJ,u.On]}),i})();const M=function(i){return{"has-error":i}};function N(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"label"),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"div",5)(4,"user-picker",19),e.NdJ("valueChanged",function(a){const g=e.CHM(t).$implicit;return e.KtG(g.name=a)}),e.qZA()(),e.TgZ(5,"span",20),e._uU(6),e.qZA()()}if(2&i){const t=d.$implicit,n=e.oxw();e.xp6(3),e.Q6J("ngClass",e.VKq(3,M,n.isEmptyString(t.name))),e.xp6(1),e.Q6J("required",!0),e.xp6(2),e.Oqu(t.text)}}let Z=(()=>{class i{constructor(t,n,a,c){this.service=t,this.bsModalRef=n,this.alertService=a,this.utilService=c,this._names=[],this.constant=A.s,this.datepickerConfig={dateInputFormat:A.s.DateFormatMoment,showTime:!1},this.onClose=new e.vpe,this.assignments=[],this.formData={StartingDueDate:new Date,DaysBetween:2,Names:this._names},this.assignmentModel={ID:0,AssignedTo:"",AssignmentInfo:"",FullNameAssignedTo:"",DueDate:new Date,ParentAssignmentID:0,GenericIncidentID:0,IncidentDescription:"",AssignedBy:"",FullNameAssignedBy:"",Cancelled:!1,Completed:!1,CompletionDate:null,IsCurrentUser:!1,Notes:"",Active:!0}}ngOnInit(){this.assignmentModel.GenericIncidentID=this.assignmentInfo.genericID,this.assignmentModel.IncidentDescription=this.assignmentInfo.description,this.assignments=[this.makeAssignmentModel("Risk setup on Visual Management Tracker"),this.makeAssignmentModel("Department upload Quote/Invoice"),this.makeAssignmentModel("Risk send incident form and PD report to TPA if necessary (Quote/invoice greater than $1,000)"),this.makeAssignmentModel("Risk ensure claim set up with TPA, verify payment and update Visual Management")];for(let t=0;t<this.assignments.length;t++)this.formData.Names.push({name:"",text:this.assignments[t].AssignmentInfo})}isEmptyString(t){return this.utilService.isEmptyString(t)}isAllNamesAvailable(){let t=!0;for(let n=0;n<this.formData.Names.length&&(t=!this.isEmptyString(this.formData.Names[n].name),t);n++);return t}makeAssignmentModel(t){const n=Object.assign({},this.assignmentModel);return n.AssignmentInfo=t,n}ok(){const t=this.formData.StartingDueDate;for(let n=0;n<this.assignments.length;n++){const a=new Date;a.setDate(t.getDate()+this.formData.DaysBetween*n),this.assignments[n].FullNameAssignedTo=this.formData.Names[n].name,this.assignments[n].DueDate=a}this.service.createWorkflow(this.assignments).subscribe({next:n=>{this.onClose.emit(n),this.alertService.success("Added new workflow."),this.bsModalRef?.hide()},error:n=>{this.alertService.error("Error while saving workflow.")}})}cancel(){this.bsModalRef?.hide()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(C.Y),e.Y36(v.UZ),e.Y36(T.c),e.Y36(I.F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["workflow-modal"]],inputs:{assignmentInfo:"assignmentInfo"},outputs:{onClose:"onClose"},decls:26,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],["name","assignmentForm"],[1,"form-group"],[3,"ngClass"],["for","DueDate"],[1,"input-group"],["type","text","name","DueDate","placeholder","Due Date","bsDatepicker","","close-text","Close","required","",1,"form-control",3,"bsConfig","ngModel","ngModelChange"],["dpDueDate","bsDatepicker","dueDate","ngModel"],[1,"input-group-btn"],["type","button",1,"btn","btn-default",3,"click"],[1,"glyphicon","glyphicon-calendar"],["for","DaysBetween"],["type","text","name","DaysBetween",3,"ngModel","ngModelChange"],["class","form-group",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-cancel",3,"click"],[3,"required","valueChanged"],[1,"help-block"]],template:function(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Create Workflow"),e.qZA()(),e.TgZ(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Starting Due Date"),e.qZA(),e.TgZ(9,"div",7)(10,"input",8,9),e.NdJ("ngModelChange",function(g){return n.formData.StartingDueDate=g}),e.qZA(),e.TgZ(13,"span",10)(14,"button",11),e.NdJ("click",function(){e.CHM(a);const g=e.MAs(11);return e.KtG(g.show())}),e._UZ(15,"i",12),e.qZA()()()()(),e.TgZ(16,"div",4)(17,"label",13),e._uU(18,"Days Between Tasks"),e.qZA(),e.TgZ(19,"input",14),e.NdJ("ngModelChange",function(g){return n.formData.DaysBetween=g}),e.qZA()(),e.YNc(20,N,7,5,"div",15),e.qZA()(),e.TgZ(21,"div",16)(22,"button",17),e.NdJ("click",function(){return n.ok()}),e._uU(23,"Add Workflow"),e.qZA(),e.TgZ(24,"button",18),e.NdJ("click",function(){return n.cancel()}),e._uU(25,"Cancel"),e.qZA()()}if(2&t){const a=e.MAs(11),c=e.MAs(12);e.xp6(6),e.Q6J("ngClass",e.VKq(7,M,c.invalid&&(c.dirty||c.touched))),e.xp6(4),e.Q6J("bsConfig",n.datepickerConfig)("ngModel",n.formData.StartingDueDate),e.xp6(4),e.uIk("aria-expanded",a.isOpen),e.xp6(5),e.Q6J("ngModel",n.formData.DaysBetween),e.xp6(1),e.Q6J("ngForOf",n.formData.Names),e.xp6(2),e.Q6J("disabled",c.invalid||!n.isAllNamesAvailable())}},dependencies:[h.mk,h.sg,u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.On,u.F,f.Np,f.Y5,_.S]}),i})();var w=m(3071);function y(i,d){1&i&&(e.TgZ(0,"div",8),e._uU(1," There aren't any assigned tasks yet. "),e.qZA())}function U(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",23),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.completeAssignment(a))}),e._UZ(1,"span",3),e.qZA()}}function J(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.cancelAssignment(a))}),e._UZ(1,"span",25),e.qZA()}}function q(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.openAssignmentModal(a.ID))}),e._UZ(1,"span",27),e.qZA()}}function S(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij("Depends on Assignment #",t.ParentAssignmentID,"")}}function Y(i,d){if(1&i&&(e.TgZ(0,"span",28),e._uU(1),e.YNc(2,S,2,1,"span",21),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij(" #",t.ID," "),e.xp6(1),e.Q6J("ngIf",n.isAdmin&&0!=t.ParentAssignmentID&&!t.Active)}}function Q(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij("Completed on ",e.xi3(2,1,t.CompletionDate,n.constant.DateFormatUi),"")}}function O(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij("Due: ",e.xi3(2,1,t.DueDate,n.constant.DateFormatUi),"")}}const E=function(i){return{"inactive-task":i}},l=function(i){return{"completed-task":i}};function p(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"li",11)(1,"div",12),e.YNc(2,U,2,0,"div",13),e.TgZ(3,"div",14),e.NdJ("click",function(){const c=e.CHM(t).$implicit,g=e.oxw(2);return e.KtG(g.showNotes(c))}),e._UZ(4,"span",4),e.qZA(),e.YNc(5,J,2,0,"div",15),e.YNc(6,q,2,0,"div",16),e.TgZ(7,"div",17)(8,"span",18),e._uU(9),e.qZA(),e.YNc(10,Y,3,2,"span",19),e.TgZ(11,"span",20),e.YNc(12,Q,3,4,"span",21),e.YNc(13,O,3,4,"span",21),e.qZA(),e.TgZ(14,"span",22),e._uU(15),e.qZA()()()()}if(2&i){const t=d.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.VKq(10,E,!t.Active)),e.xp6(2),e.Q6J("ngIf",t.IsCurrentUser&&!t.Completed&&t.Active),e.xp6(3),e.Q6J("ngIf",n.isAdmin&&!t.Completed),e.xp6(1),e.Q6J("ngIf",n.isAdmin&&!t.Completed),e.xp6(2),e.Q6J("ngClass",e.VKq(12,l,t.Completed)),e.xp6(1),e.hij("Assigned to ",t.FullNameAssignedTo,""),e.xp6(1),e.Q6J("ngIf",n.isAdmin),e.xp6(2),e.Q6J("ngIf",t.Completed),e.xp6(1),e.Q6J("ngIf",!t.Completed),e.xp6(2),e.Oqu(t.AssignmentInfo)}}function s(i,d){if(1&i&&(e.TgZ(0,"ul",9),e.YNc(1,p,16,14,"li",10),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.assignments)}}function o(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"button",31),e._uU(3," Add Tasks "),e._UZ(4,"span",32),e.qZA(),e.TgZ(5,"ul",33)(6,"li")(7,"a",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openAssignmentModal())}),e._uU(8,"Add Single Task"),e.qZA()(),e.TgZ(9,"li")(10,"a",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openWorkflowModal("other"))}),e._uU(11,"Add Workflow"),e.qZA()()()()()}}let r=(()=>{class i{constructor(t,n,a,c){this.service=t,this.modalService=n,this.userService=a,this.alertService=c,this.genericId=0,this.description="",this.assignments=[],this.constant=A.s}ngOnInit(){this.loadAssignments()}get isAdmin(){return this.userService.loggedInUser?.isAdmin??!1}loadAssignments(){this.genericId>0&&this.service.getAssignmentsForIncident(this.genericId).subscribe({next:t=>{this.assignments=t},error:t=>{this.alertService.error("Could not load tasks.")}})}openWorkflowModal(t){this.bsModalRef=this.modalService.show(Z,{initialState:{assignmentInfo:{genericID:this.genericId,description:this.description,workflowName:t}}}),this.bsModalRef.content.closeBtnName="Close",this.bsModalRef.content.onClose.subscribe(a=>{this.assignments.push(...a)})}openAssignmentModal(t){this.bsModalRef=this.modalService.show(F,{initialState:{parentId:t,genericId:this.genericId,description:this.description}}),this.bsModalRef.content.closeBtnName="Close",this.bsModalRef.content.onClose.subscribe(a=>{this.assignments.push(a)})}showNotes(t){this.bsModalRef=this.modalService.show(D,{initialState:{assignment:t}}),this.bsModalRef.content.closeBtnName="Close",this.bsModalRef.content.onClose.subscribe(a=>{t.IsCurrentUser&&(t.Notes=a)})}cancelAssignment(t){this.service.cancelAssignment(t.ID).subscribe({next:n=>{this.loadAssignments()},error:n=>{this.alertService.error("Error canceling task.")}})}completeAssignment(t){this.service.completeAssignment(t.ID).subscribe({next:n=>{this.loadAssignments()},error:n=>{this.alertService.error("Error completing task.")}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(C.Y),e.Y36(v.tT),e.Y36(w.K),e.Y36(T.c))},i.\u0275cmp=e.Xpm({type:i,selectors:[["assignments-for-incident"]],inputs:{genericId:"genericId",description:"description"},decls:15,vars:3,consts:[[1,"panel","panel-default"],[1,"panel-heading"],[1,"text-center"],[1,"glyphicon","glyphicon-ok"],[1,"glyphicon","glyphicon-comment"],["class","panel-body",4,"ngIf"],["class","assignment-list",4,"ngIf"],["class","panel-footer",4,"ngIf"],[1,"panel-body"],[1,"assignment-list"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"wrap"],["class","complete",3,"click",4,"ngIf"],[1,"notes",3,"click"],["class","cancel",3,"click",4,"ngIf"],["class","add",3,"click",4,"ngIf"],[1,"details"],[1,"assigned-to",3,"ngClass"],["class","assignment-number",4,"ngIf"],[1,"duedate"],[4,"ngIf"],[1,"info"],[1,"complete",3,"click"],[1,"cancel",3,"click"],[1,"glyphicon","glyphicon-remove"],[1,"add",3,"click"],[1,"glyphicon","glyphicon-plus"],[1,"assignment-number"],[1,"panel-footer"],[1,"btn-group"],["type","button","data-toggle","dropdown",1,"btn","btn-primary","dropdown-toggle"],[1,"caret"],[1,"dropdown-menu"],[3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3," Assigned Tasks "),e.qZA(),e.TgZ(4,"p")(5,"small"),e._UZ(6,"span",3),e._uU(7,"= Complete Task"),e.qZA()(),e.TgZ(8,"p")(9,"small"),e._UZ(10,"span",4),e._uU(11,"= Notes"),e.qZA()()(),e.YNc(12,y,2,0,"div",5),e.YNc(13,s,2,1,"ul",6),e.YNc(14,o,12,0,"div",7),e.qZA()),2&t&&(e.xp6(12),e.Q6J("ngIf",0==n.assignments.length),e.xp6(1),e.Q6J("ngIf",n.assignments.length>0),e.xp6(1),e.Q6J("ngIf",n.isAdmin))},dependencies:[h.mk,h.sg,h.O5,h.uU]}),i})()},5331:(G,x,m)=>{m.d(x,{Y:()=>E});var A=m(2340),e=m(1571),C=m(2831),v=m(1129),T=m(8270);let I=(()=>{class l{constructor(s){this.utils=s,this.apiUrl=A.N.apiUrl}sendToTPA(s,o){return this.utils.post("api/attachments/sendtotpa/"+s,o)}downloadFiles(s,o){if(o.length>0){let r="api/attachments/download/"+s+"?";for(let i=0;i<o.length;i++)r+="fileids="+o[i]+"&";r=r.substring(0,r.length-1),window.open(`${this.apiUrl}/${r}`)}else window.alert("No files selected")}getAttachments(s){return this.utils.get("api/attachments/list/"+s)}deleteAttachment(s){return this.utils.delete("api/attachments/"+s)}getFileChoices(){return this.utils.get("api/strings/file")}}return l.\u0275fac=function(s){return new(s||l)(e.LFG(T.F))},l.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();var h=m(388),u=m(426),f=m(6895),_=m(4006);function b(l,p){if(1&l&&(e.TgZ(0,"div",30),e._uU(1),e.qZA()),2&l){const s=e.oxw();e.xp6(1),e.Oqu(s.errorMessage)}}function F(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"li")(1,"a",31),e.NdJ("click",function(){const i=e.CHM(s).$implicit,d=e.oxw();return e.KtG(d.fileData.Title=i.Name)}),e._uU(2),e.qZA()()}if(2&l){const s=p.$implicit;e.xp6(2),e.Oqu(s.Name)}}function k(l,p){1&l&&(e.TgZ(0,"div"),e._uU(1," No files added. "),e.qZA())}const D=function(l,p){return{"glyphicon-picture":l,"glyphicon-file":p}};function M(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"div",34)(1,"div",35)(2,"input",36),e.NdJ("ngModelChange",function(r){const d=e.CHM(s).$implicit;return e.KtG(d.Selected=r)}),e.qZA(),e._UZ(3,"span",37),e.TgZ(4,"a",38),e._uU(5),e.qZA()()()}if(2&l){const s=p.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("ngModel",s.Selected),e.xp6(1),e.Q6J("ngClass",e.WLB(5,D,s.IsImage,!s.IsImage)),e.xp6(1),e.hYB("href","",o.apiUrl,"/api/attachments/",s.ID,"",e.LSH),e.xp6(1),e.Oqu(s.Title)}}function N(l,p){if(1&l&&(e.TgZ(0,"div",32),e.YNc(1,M,6,8,"div",33),e.qZA()),2&l){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.newFiles)}}const Z=function(l){return{"has-error":l}};let w=(()=>{class l{constructor(s,o,r){this.service=s,this.bsModalRef=o,this.alertService=r,this.constant=C.s,this.fileChoices=[],this.fileInfo={},this.onClose=new e.vpe,this.fileData={Title:"",ID:0},this.upload=[],this.newFiles=[],this.errorMessage="",this.apiUrl=A.N.apiUrl,this.uploader=new v.bA({url:`${this.apiUrl}/api/attachments`,removeAfterUpload:!0}),this.uploader.onAfterAddingFile=i=>{i.withCredentials=!1},this.uploader.onBuildItemForm=(i,d)=>{d.append("fileInfo",JSON.stringify(this.fileData))},this.uploader.onErrorItem=(i,d,t,n)=>{this.errorMessage=415===t?"Unsupported file. Only PDF, Word, Excel, GIF, JPG, and PNG are allowed.":"An error occurred when uploading the file. Please try again or contact ITS."},this.uploader.onSuccessItem=(i,d,t,n)=>{const a=JSON.parse(d);this.newFiles.push(a),this.onClose.emit(a)}}ngOnInit(){this.fileData.ID=this.fileInfo.genericID,this.service.getFileChoices().subscribe({next:s=>{this.fileChoices=s}})}cancel(){this.bsModalRef?.hide()}}return l.\u0275fac=function(s){return new(s||l)(e.Y36(I),e.Y36(h.UZ),e.Y36(u.c))},l.\u0275cmp=e.Xpm({type:l,selectors:[["file-modal"]],inputs:{fileInfo:"fileInfo"},outputs:{onClose:"onClose"},decls:41,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],["class","alert alert-danger",4,"ngIf"],["name","fileForm",1,"form-horizontal"],[1,"form-group",3,"ngClass"],["for","Title",1,"col-md-4","control-label"],[1,"glyphicon","glyphicon-asterisk","requiredColor"],[1,"col-md-8"],[1,"input-group"],["type","text","name","Title","id","Title","required","",1,"form-control",3,"ngModel","ngModelChange"],["fileTitle","ngModel"],[1,"input-group-btn"],["type","button","data-toggle","dropdown",1,"btn","btn-default","dropdown-toggle"],[1,"caret"],["role","menu",1,"dropdown-menu","dropdown-menu-right"],[4,"ngFor","ngForOf"],["for","FileUpload",1,"col-md-4","control-label"],["type","file","ng2FileSelect","",1,"form-control",3,"uploader"],[1,"help-block"],[1,"form-group"],[1,"col-md-offset-4","col-md-3"],["type","button",1,"btn","btn-default",3,"disabled","click"],[1,"well"],[1,"panel","panel-default"],[1,"panel-body"],[4,"ngIf"],["class","list-group",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-default",3,"click"],[1,"alert","alert-danger"],[3,"click"],[1,"list-group"],["class","list-group-item clearfix",4,"ngFor","ngForOf"],[1,"list-group-item","clearfix"],[1,"pull-left"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"glyphicon",3,"ngClass"],["target","_blank",3,"href"]],template:function(s,o){if(1&s&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Attach New Files"),e.qZA()(),e.TgZ(3,"div",2),e.YNc(4,b,2,1,"div",3),e.TgZ(5,"form",4)(6,"div",5)(7,"label",6),e._uU(8," File Description "),e._UZ(9,"span",7),e.qZA(),e.TgZ(10,"div",8)(11,"div",9)(12,"input",10,11),e.NdJ("ngModelChange",function(i){return o.fileData.Title=i}),e.qZA(),e.TgZ(14,"div",12)(15,"button",13),e._uU(16," Common Choices "),e._UZ(17,"span",14),e.qZA(),e.TgZ(18,"ul",15),e.YNc(19,F,3,1,"li",16),e.qZA()()()()(),e.TgZ(20,"div",5)(21,"label",17),e._uU(22,"File"),e.qZA(),e.TgZ(23,"div",8),e._UZ(24,"input",18),e.TgZ(25,"span",19),e._uU(26,"Only PDF, Word, Excel, GIF, PNG, JPG supported"),e.qZA()()(),e.TgZ(27,"div",20)(28,"div",21)(29,"button",22),e.NdJ("click",function(){return o.uploader.uploadAll()}),e._uU(30,"Add File"),e.qZA()()()(),e.TgZ(31,"div",23)(32,"h4"),e._uU(33,"Files Uploaded"),e.qZA(),e.TgZ(34,"div",24)(35,"div",25),e.YNc(36,k,2,0,"div",26),e.YNc(37,N,2,1,"div",27),e.qZA()()()(),e.TgZ(38,"div",28)(39,"button",29),e.NdJ("click",function(){return o.cancel()}),e._uU(40,"Close"),e.qZA()()),2&s){const r=e.MAs(13);e.xp6(4),e.Q6J("ngIf",o.errorMessage.length>0),e.xp6(2),e.Q6J("ngClass",e.VKq(9,Z,r.invalid&&(r.dirty||r.touched))),e.xp6(6),e.Q6J("ngModel",o.fileData.Title),e.xp6(7),e.Q6J("ngForOf",o.fileChoices),e.xp6(1),e.Q6J("ngClass",e.VKq(11,Z,!o.uploader.getNotUploadedItems().length)),e.xp6(4),e.Q6J("uploader",o.uploader),e.xp6(5),e.Q6J("disabled",r.invalid||!o.uploader.getNotUploadedItems().length),e.xp6(7),e.Q6J("ngIf",0==o.newFiles.length),e.xp6(1),e.Q6J("ngIf",o.newFiles.length>0)}},dependencies:[f.mk,f.sg,f.O5,_._Y,_.Fj,_.Wl,_.JJ,_.JL,_.Q7,_.On,_.F,v.C6]}),l})();var y=m(3071);function U(l,p){1&l&&(e.TgZ(0,"div",9),e._uU(1," There aren't any files for this incident yet. "),e.qZA())}function J(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"input",16),e.NdJ("ngModelChange",function(r){e.CHM(s);const i=e.oxw().$implicit;return e.KtG(i.Selected=r)}),e.qZA()}if(2&l){const s=e.oxw().$implicit;e.Q6J("ngModel",s.Selected)}}function q(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"div",17)(1,"span",18),e.NdJ("click",function(){e.CHM(s);const r=e.oxw().$implicit,i=e.oxw();return e.KtG(i.deleteAttachment(r))}),e.qZA()()}}const S=function(l,p){return{"glyphicon-picture":l,"glyphicon-file":p}};function Y(l,p){if(1&l&&(e.TgZ(0,"div",10)(1,"div",11),e.YNc(2,J,1,1,"input",12),e._UZ(3,"span",13),e.TgZ(4,"a",14),e._uU(5),e.qZA()(),e.YNc(6,q,2,0,"div",15),e.qZA()),2&l){const s=p.$implicit,o=e.oxw();e.xp6(2),e.Q6J("ngIf",o.isAdmin),e.xp6(1),e.Q6J("ngClass",e.WLB(6,S,s.IsImage,!s.IsImage)),e.xp6(1),e.hYB("href","",o.apiUrl,"/api/attachments/",s.ID,"",e.LSH),e.xp6(1),e.Oqu(s.Title),e.xp6(1),e.Q6J("ngIf",o.isAdmin)}}function Q(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.openFileModal())}),e._uU(1,"Add File"),e.qZA()}}function O(l,p){if(1&l){const s=e.EpF();e.TgZ(0,"div",20)(1,"button",21),e._uU(2," Manage Files "),e._UZ(3,"span",22),e.qZA(),e.TgZ(4,"ul",23)(5,"li")(6,"a",24),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.openFileModal())}),e._uU(7,"Add File"),e.qZA()(),e.TgZ(8,"li")(9,"a",24),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.downloadFiles())}),e._uU(10,"Download PDF & Checked Files as Zip"),e.qZA()(),e.TgZ(11,"li")(12,"a",24),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.sendToTPA())}),e._uU(13,"Send PDF & Checked Files to TPA"),e.qZA()()()()}}let E=(()=>{class l{constructor(s,o,r,i){this.service=s,this.modalService=o,this.alertService=r,this.userService=i,this.genericId=0,this.attachments=[],this.apiUrl=A.N.apiUrl}ngOnInit(){this.service.getAttachments(this.genericId).subscribe({next:s=>{this.attachments=s},error:s=>{this.alertService.error("Could not load attached files.")}})}get isAdmin(){return this.userService.loggedInUser?.isAdmin??!1}deleteAttachment(s){this.service.deleteAttachment(s.ID).subscribe({next:o=>{const r=this.attachments.indexOf(s);this.attachments.splice(r,1),this.alertService.info("Deleted file.")},error:o=>{this.alertService.error("Error deleting file.")}})}sendToTPA(){const s=[];this.attachments.forEach(function(o){o.Selected&&s.push(o.ID)}),this.service.sendToTPA(this.genericId,s).subscribe({next:o=>{this.alertService.info("Sent report to TPA.")},error:o=>{this.alertService.error("Error sending to TPA.")}})}downloadFiles(){const s=[];this.attachments.forEach(function(o){o.Selected&&s.push(o.ID)});try{this.service.downloadFiles(this.genericId,s)}catch{this.alertService.error("Error downloading files.")}}openFileModal(){this.bsModalRef=this.modalService.show(w,{initialState:{fileInfo:{genericID:this.genericId}}}),this.bsModalRef.content.closeBtnName="Close",this.bsModalRef.content.onClose.subscribe(o=>{this.attachments.push(o)})}}return l.\u0275fac=function(s){return new(s||l)(e.Y36(I),e.Y36(h.tT),e.Y36(u.c),e.Y36(y.K))},l.\u0275cmp=e.Xpm({type:l,selectors:[["attachments"]],inputs:{genericId:"genericId"},decls:10,vars:4,consts:[[1,"panel","panel-default"],[1,"panel-heading"],[1,"text-center"],["class","panel-body",4,"ngIf"],[1,"list-group"],["class","list-group-item clearfix",4,"ngFor","ngForOf"],[1,"panel-footer","clearfix"],["type","button","class","btn btn-default",3,"click",4,"ngIf"],["class","btn-group",4,"ngIf"],[1,"panel-body"],[1,"list-group-item","clearfix"],[1,"pull-left"],["type","checkbox",3,"ngModel","ngModelChange",4,"ngIf"],[1,"glyphicon",3,"ngClass"],["target","_blank",3,"href"],["class","pull-right",4,"ngIf"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"pull-right"],["title","Delete",1,"glyphicon","glyphicon-remove","alert-danger",2,"cursor","pointer",3,"click"],["type","button",1,"btn","btn-default",3,"click"],[1,"btn-group"],["type","button","data-toggle","dropdown",1,"btn","btn-primary","dropdown-toggle"],[1,"caret"],[1,"dropdown-menu"],[3,"click"]],template:function(s,o){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"Supporting Files"),e.qZA()(),e.YNc(4,U,2,0,"div",3),e.TgZ(5,"div",4),e.YNc(6,Y,7,9,"div",5),e.qZA(),e.TgZ(7,"div",6),e.YNc(8,Q,2,0,"button",7),e.YNc(9,O,14,0,"div",8),e.qZA()()),2&s&&(e.xp6(4),e.Q6J("ngIf",0==o.attachments.length),e.xp6(2),e.Q6J("ngForOf",o.attachments),e.xp6(2),e.Q6J("ngIf",!o.isAdmin),e.xp6(1),e.Q6J("ngIf",o.isAdmin))},dependencies:[f.mk,f.sg,f.O5,_.Wl,_.JJ,_.On]}),l})()}}]);